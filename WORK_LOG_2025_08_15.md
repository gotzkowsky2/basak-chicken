# 작업 로그 (2025-08-15)

## 배포/운영
- Next.js 15.3.5, 포트 3001 고정(`package.json` `start`), PM2 단일 인스턴스(fork)로 정리
- 빌드 산출물 청크 누락 오류(`Cannot find module './8548.js'`) → `.next` 클린 후 재빌드/재시작으로 복구
- `/admin-choose` 존재 확인 및 리다이렉트 추가(`next.config.js` → `/admin`)
- 전역 CSS 로드 실패 대비 `CssGuard` 추가(`src/app/layout.tsx`) → 미적용 시 1회 캐시버스트 리로드

## 공지사항
- 삭제 시 비활성화 → 실제 삭제로 변경: `src/app/api/admin/notices/[id]/route.ts` (`delete`)
- 새 공지 팝업 가독성 강화: `src/app/admin/notices/page.tsx` (입력/레이블 대비, focus ring, placeholder)

## 재고/구매
- “마지막 업데이트 + 이름” 표기 확대
  - 관리자 재고: `src/app/admin/inventory/page.tsx` (날짜+이름, 모바일 truncate)
  - 직원 재고: `src/app/employee/inventory/page.tsx` (날짜+이름, 모바일 레이아웃)
  - 관리자 ‘업데이트 필요’ 테이블에 “업데이트한 사람” 열 추가
- 관리자 재고 수정 시 기록: `src/app/api/admin/inventory/route.ts` `PUT` → `lastCheckedBy = admin.name`
- 구매요청 승인자 기록: `src/app/api/admin/purchase-requests/route.ts` `PUT` → `approvedBy = admin.name`
- 재고 삭제 시 참조 정리 및 컬럼명 수정: 태그/체크 삭제 where 키 `itemId`로 통일

## 업데이트 필요 보기
- 관리자 화면에 “모든 목록 보기” 토글 추가: `src/app/admin/inventory/stale/page.tsx` (`showAll`, `loadAll()`)
- 직원용 ‘업데이트 필요’ 페이지/검색 추가
  - 페이지: `src/app/employee/inventory/stale/page.tsx`
  - API: `src/app/api/employee/inventory/stale/route.ts`
  - 검색/초기화 UI 추가
- 직원 레이아웃/메뉴/메인 카드에 항목 정렬
  - 메뉴에 `재고(업데이트 필요)` 추가: `src/app/employee/layout.tsx`
  - 메인 카드에 `재고 업데이트 필요` 추가 및 제목 클릭 이동: `src/app/employee/EmployeeMainClient.tsx`
  - 메인 위젯 분리: `src/app/employee/EmployeeStaleInventory.tsx`

## 직원 인증/헤더 이슈
- 직원/관리자 쿠키 모두 허용(`__Host-*` 포함): `src/app/api/employee/me/route.ts`, `src/app/api/employee/feed/route.ts`
- 관리자 세션으로 직원 페이지 접근 시 헤더 노출 보장
- 미들웨어에서 직원 영역 접근 조건 개선: `src/middleware.ts`

## 모바일 가독성
- 직원 메인 모바일 친화 UI 일부 개선(그리드 간격/카드 라운드, 섹션 타이틀 등): `src/app/employee/EmployeeMainClient.tsx`

## 확인
- 빌드 성공/PM2 재시작 후 관리자/직원 페이지 정상
- 직원 페이지 메뉴/공지/업데이트 필요 위젯/카드 정상 표시 확인

---
변경 주요 파일(요약)
- API: `src/app/api/admin/notices/[id]/route.ts`, `src/app/api/admin/purchase-requests/route.ts`, `src/app/api/admin/inventory/route.ts`, `src/app/api/admin/inventory/stale/route.ts`, `src/app/api/employee/inventory/stale/route.ts`, `src/app/api/employee/me/route.ts`, `src/app/api/employee/feed/route.ts`
- 페이지/클라이언트: `src/app/admin/inventory/stale/page.tsx`, `src/app/admin/inventory/page.tsx`, `src/app/employee/inventory/page.tsx`, `src/app/employee/inventory/stale/page.tsx`, `src/app/employee/EmployeeMainClient.tsx`, `src/app/employee/EmployeeStaleInventory.tsx`, `src/app/admin/notices/page.tsx`, `src/app/employee/layout.tsx`
- 설정/전역: `next.config.js`, `src/app/layout.tsx`, `src/middleware.ts`
